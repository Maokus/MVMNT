@tailwind base;
@tailwind components;
@tailwind utilities;

/* Preserve existing look using Tailwind layers */
@layer base {
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    :root {
        --twc-background: #1e1e1e;
        --twc-panel: #252526;
        --twc-menubar: #2d2d30;
        --twc-border: #3e3e42;
        --twc-control: #3c3c3c;
        --twc-control2: #464647;
        --twc-accent: #0e639c;
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background: var(--twc-background);
        color: #fff;
        height: 100vh;
    }
    a {
        color: #fff;
    }
}

/* Map legacy class names to Tailwind so markup can stay unchanged */
@layer components {
    .app-container {
        @apply flex flex-col h-screen w-screen;
    }
    .menu-bar {
        @apply border-b px-4 py-2 flex items-center justify-between gap-5 h-12 shrink-0;
        background-color: var(--twc-menubar);
        border-color: var(--twc-border);
    }
    .menu-section {
        @apply flex items-center gap-2;
    }
    .menu-section h3 {
        @apply text-xs text-neutral-300 mr-2 font-medium;
    }

    .scene-name-section {
        @apply flex-1 justify-center relative;
    }
    .scene-name-container {
        @apply flex items-center gap-1.5 relative;
    }
    .scene-name-display {
        @apply text-sm text-white font-medium cursor-pointer px-2 py-1 rounded transition-colors max-w-[300px] overflow-hidden text-ellipsis whitespace-nowrap hover:bg-white/10;
    }
    .scene-name-input {
        @apply text-sm text-white border rounded px-2 py-1 outline-none min-w-[150px] max-w-[300px];
        background-color: var(--twc-control);
        border-color: var(--twc-accent);
    }
    /* Scene menu mappings removed; using inline utilities in MenuBar */

    .main-workspace {
        @apply flex flex-1 min-h-0 overflow-hidden;
    }
    /* Bottom timeline dock */
    .timeline-container {
        @apply shrink-0 flex flex-col overflow-hidden;
        background-color: var(--twc-background);
        border-color: var(--twc-border);
    }
    .timeline-panel {
        @apply flex flex-col h-full min-h-[160px];
    }
    .timeline-header {
        @apply border-b px-3 py-1.5;
        background-color: var(--twc-menubar);
        border-color: var(--twc-border);
    }
    .timeline-ruler {
        @apply flex mt-1.5 h-[18px];
        gap: 0;
    }
    .timeline-ruler .tick {
        position: relative;
        width: 5%;
        border-left: 1px solid var(--twc-border);
    }
    .timeline-ruler .tick .label {
        position: absolute;
        top: 0;
        left: 2px;
        font-size: 10px;
        color: #9a9a9a;
    }
    .timeline-body {
        @apply flex flex-1 min-h-0 overflow-hidden;
    }
    .tracklist-container {
        @apply h-full;
    }
    .track-list {
        @apply flex-1;
    }
    .timeline-row {
        display: grid;
        grid-template-columns: 180px 1fr;
        align-items: stretch;
        border-bottom: 1px solid #2f2f33;
        min-height: 28px;
    }
    .track-label {
        background: #232323;
        border-right: 1px solid #2f2f33;
        padding: 6px 10px;
        font-size: 12px;
        color: #cfcfcf;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .track-lane {
        position: relative;
    }
    .clip {
        position: absolute;
        top: 5px;
        height: 18px;
        background: #0e639c;
        border: 1px solid #1177bb;
        border-radius: 3px;
        opacity: 0.9;
    }
    .preview-panel {
        @apply flex-[2] border-r flex flex-col min-w-0 h-full;
        background-color: var(--twc-panel);
        border-color: var(--twc-border);
    }
    .canvas-container {
        @apply flex-1 flex items-center justify-center p-5 min-h-0 max-w-full max-h-full w-full h-full overflow-hidden;
    }
    #canvas {
        @apply border rounded bg-black shadow-lg block;
        image-rendering: pixelated;
        border-color: var(--twc-border);
    }
    .playback-controls {
        @apply border-t px-5 py-3 flex items-center gap-3 shrink-0;
        background-color: var(--twc-menubar);
        border-color: var(--twc-border);
    }
    .progress-bar-container {
        @apply relative h-2 rounded cursor-pointer overflow-hidden flex-grow;
        background-color: var(--twc-border);
    }
    .progress-bar-fill {
        @apply absolute top-0 left-0 h-full bg-blue-600 w-0;
    }
    #playPauseBtn {
        @apply min-w-[38px] px-[10px];
    }

    /* Side panels mappings removed; now inlined in JSX */

    /* .btn* legacy mappings removed; using inline utilities in components */

    .file-input {
        @apply hidden;
    }
    .file-input + label {
        @apply cursor-pointer;
    }
    .file-input-container {
        @apply flex flex-col gap-2;
    }
    .file-input-label {
        @apply inline-block px-3 py-1.5 bg-blue-600 text-white rounded cursor-pointer text-xs text-center transition w-fit hover:bg-blue-700;
    }
    .current-file {
        @apply text-[11px] text-neutral-300 italic;
    }

    .file-input-wrapper {
        @apply flex items-center gap-2;
    }
    /* .btn-file removed; migrated to inline classes */
    .file-name {
        @apply text-[11px] text-neutral-300 italic whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px];
    }
    .file-preview {
        @apply mt-1 border border-dashed rounded p-2 min-h-[50px] flex items-center justify-center bg-white/5;
        border-color: var(--twc-control2);
    }
    .file-preview:empty {
        @apply hidden;
    }
    .file-preview img {
        @apply rounded shadow;
    }

    .time-display {
        @apply px-2 py-1 rounded font-mono text-[11px] text-neutral-300 border;
        background-color: var(--twc-control);
        border-color: var(--twc-control2);
    }

    .settings-grid {
        @apply flex flex-col gap-6;
    }
    .setting-group {
        @apply mb-5;
    }
    .setting-group h4 {
        @apply mb-3 text-white text-[13px] font-semibold border-b pb-1;
        border-color: var(--twc-border);
    }
    .setting-group label {
        @apply block mb-1.5 font-medium text-white text-xs;
    }
    .setting-group input,
    .setting-group select {
        @apply w-full px-2 py-1 border rounded text-xs text-white mb-2;
        background-color: var(--twc-control);
        border-color: var(--twc-control2);
    }
    .setting-group input:focus,
    .setting-group select:focus {
        @apply outline-none;
        border-color: var(--twc-accent);
        box-shadow: 0 0 0 2px color-mix(in oklab, var(--twc-accent) 20%, transparent);
    }
    .setting-group input[type='checkbox'] {
        @apply w-auto mr-2;
        accent-color: #0e639c;
    }
    .time-signature-controls {
        @apply flex items-center gap-2 mb-2;
    }
    .time-signature-controls select {
        @apply w-auto min-w-[50px] mb-0;
    }
    .apply-btn {
        @apply px-2 py-1 text-[11px] mb-0;
    }

    /* Progress and onboarding overlays migrated to inline utilities */

    /* .download-btn removed; migrated to inline classes */

    .scene-editor {
        @apply flex flex-col gap-4 text-neutral-300;
    }
    .elements-panel,
    .config-panel {
        @apply bg-transparent;
    }
    /* Make the elements area take available height and scroll */
    .elements-panel {
        @apply flex flex-col min-h-0;
    }
    .scene-editor-container {
        @apply flex-1 overflow-y-auto p-4 min-h-0;
    }
    /* Element list mappings removed; now using inline utilities in JSX */

    .config-editor {
        @apply text-white;
    }
    .config-editor-header {
        @apply mb-5 pb-2 border-b border-border;
    }
    .config-editor-header h3 {
        @apply m-0 mb-1 text-white text-sm font-semibold;
    }
    .config-editor-header .description {
        @apply m-0 text-neutral-300 text-xs;
    }
    .config-editor-form {
        @apply flex flex-col gap-3;
    }
    .form-field {
        @apply flex flex-col gap-1 min-h-[32px];
    }
    .form-field .field-row {
        @apply flex items-center gap-2;
    }
    .form-field label {
        @apply font-medium text-white text-xs shrink-0 text-left;
        min-width: 80px;
    }
    .form-field .macro-assignment-select {
        @apply shrink-0 px-2 py-1 border border-control2 rounded text-xs bg-control text-white;
        width: 120px;
    }
    .form-field input,
    .form-field select:not(.macro-assignment-select) {
        @apply shrink-0 px-2 py-1 border border-control2 rounded text-xs bg-control text-white min-w-0;
        width: 120px;
    }
    .form-field input:focus,
    .form-field select:focus {
        @apply outline-none ring-2 ring-accent/30 border-accent;
    }
    .form-field input[type='checkbox'] {
        @apply w-auto m-0;
    }
    .form-field input[type='color'] {
        @apply h-8 p-0.5 rounded border border-control2;
        width: 60px;
    }
    .form-field input[type='range'] {
        width: 120px;
    }

    .range-input-container {
        @apply flex items-center gap-2.5;
        width: 120px;
    }
    .range-input-container input[type='range'] {
        @apply flex-1;
    }
    .field-description {
        @apply text-neutral-300 text-[11px] italic mt-1;
    }
    .form-field.has-description {
        @apply flex-col items-stretch gap-1;
    }
    .form-field.has-description .field-row {
        @apply flex items-center gap-2;
    }
    .form-field.has-description label {
        min-width: 80px;
    }
    .form-field.has-description .macro-assignment-select {
        width: 120px;
    }
    .form-field.has-description input,
    .form-field.has-description select:not(.macro-assignment-select) {
        width: 120px;
    }

    /* Scrollbar (webkit) */
    ::-webkit-scrollbar {
        @apply w-2;
    }
    ::-webkit-scrollbar-track {
        background-color: var(--twc-menubar);
    }
    ::-webkit-scrollbar-thumb {
        @apply bg-control2 rounded;
    }
    ::-webkit-scrollbar-thumb:hover {
        @apply bg-neutral-500;
    }

    /* About page */
    .about-page-root {
        @apply overflow-hidden;
    }
    .about-container {
        @apply flex-1 flex flex-col overflow-y-auto px-10 py-8;
        background-color: var(--twc-panel);
    }
    .about-content {
        @apply max-w-[900px] mx-auto leading-6 text-sm text-neutral-300;
    }
    .about-content h1 {
        @apply text-2xl mb-4 text-white font-semibold;
    }
    .about-content h2 {
        @apply text-lg my-8 mb-3 text-white font-semibold;
    }
    .about-content .lead {
        @apply text-[15px] text-neutral-200 mb-6;
    }
    .feature-list,
    .getting-started-list {
        @apply ml-5 flex flex-col gap-1.5;
    }
    .getting-started-list li {
        @apply ml-1;
    }
    .about-actions {
        @apply mt-12;
    }

    /* Macro UI */
    .macro-config {
        @apply mb-5;
    }
    .macro-header {
        @apply flex justify-between items-center mb-3;
    }
    .macro-header h4 {
        @apply m-0 text-base text-neutral-300;
    }
    /* .macro-add-btn removed; migrated to inline classes */
    .macro-list {
        @apply border rounded overflow-y-auto;
        background-color: var(--twc-panel);
        border-color: var(--twc-border);
    }
    .macro-empty {
        @apply p-5 text-center text-neutral-400 text-sm italic;
    }
    .macro-item {
        @apply px-3 py-2 border-b last:border-b-0;
        border-color: var(--twc-border);
    }
    .macro-control {
        @apply flex items-center gap-2 mb-1;
    }
    .macro-label {
        @apply font-medium text-neutral-300 min-w-20 text-[13px];
    }
    .macro-control input,
    .macro-control select {
        @apply flex-1 px-1.5 py-0.5 border text-neutral-300 rounded text-xs;
        background-color: var(--twc-background);
        border-color: var(--twc-border);
    }
    .macro-control input[type='checkbox'] {
        @apply flex-none w-auto;
    }
    .macro-control input[type='color'] {
        @apply w-[30px] h-5 p-0 border-0 rounded;
    }
    .macro-actions {
        @apply flex gap-1;
    }
    /* .btn-icon removed; migrated to inline classes */
    .macro-assignments {
        @apply text-[11px] text-neutral-400 ml-[88px];
    }
    .macro-create-dialog,
    .macro-assignment-dialog {
        @apply fixed inset-0 bg-black/70 z-[10000] flex items-center justify-center;
    }
    .dialog-content {
        @apply border rounded p-5 min-w-[300px] max-w-[500px] w-[90vw] max-h-[80vh] overflow-y-auto m-auto;
        background-color: var(--twc-menubar);
        border-color: var(--twc-border);
    }
    .dialog-content h4 {
        @apply m-0 mb-4 text-neutral-300;
    }
    .form-group {
        @apply mb-4;
    }
    .form-group label {
        @apply block mb-1 text-neutral-300 text-[13px];
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
        @apply w-full px-2 py-1 border border-border bg-background text-neutral-300 rounded text-[13px];
    }
    .form-group textarea {
        @apply resize-y font-mono;
    }
    .dialog-actions {
        @apply flex gap-2 justify-end mt-5 pt-4 border-t;
        border-color: var(--twc-border);
    }
    .current-assignment {
        @apply mb-4 p-2 bg-panel rounded;
    }
    .macro-options {
        @apply mb-4;
    }
    .macro-options label {
        @apply block mb-2 p-1 cursor-pointer rounded;
    }
    .macro-options label:hover {
        background-color: var(--twc-border);
    }
    .macro-options input[type='radio'] {
        @apply mr-2;
    }

    /* Properties panel scroll container */
    .properties-content {
        @apply flex-1 overflow-y-auto p-4;
    }

    /* AE style properties */
    .element-properties-panel.ae-style {
        @apply bg-[#2c2c2c] text-[#e0e0e0] font-sans text-[11px] leading-[1.2];
    }
    .ae-element-header {
        @apply border-b px-3 py-2 shrink-0;
        background-color: var(--twc-menubar);
        border-color: var(--twc-border);
    }
    .ae-element-title {
        @apply text-[13px] font-semibold text-[#e0e0e0] m-0;
    }
    .ae-properties-container {
        @apply p-1 overflow-y-auto flex-1;
    }
    .ae-property-group {
        @apply border-b border-[#383838];
    }
    .ae-properties-toolbar {
        @apply px-2 py-2 border-b border-[#383838] bg-[#1f1f1f] flex flex-col gap-2;
    }
    .ae-toolbar-row {
        @apply flex flex-wrap items-center gap-2;
    }
    .ae-properties-search {
        @apply flex-1 min-w-[140px] h-7 rounded border border-[#3f3f46] bg-[#2b2b2b] px-3 text-[12px] text-[#f4f4f5] placeholder:text-[#9ca3af] focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent/40;
    }
    .ae-element-actions {
        @apply flex flex-wrap items-center gap-1;
    }
    .ae-element-preset {
        @apply h-7 rounded border border-[#3f3f46] bg-[#1f1f1f] px-2 text-[11px] text-[#f4f4f5] focus:outline-none focus:border-accent flex-1 min-w-[180px] max-w-[260px];
    }
    .ae-element-action {
        @apply h-7 px-3 rounded border border-[#3f3f46] bg-[#1f1f1f] text-[11px] uppercase tracking-wide text-[#f4f4f5] cursor-pointer transition-colors flex-shrink-0;
    }
    .ae-element-action:disabled {
        @apply cursor-not-allowed opacity-50;
    }
    .ae-element-action:not(:disabled):hover {
        @apply border-accent bg-accent/10 text-white;
    }
    .ae-empty-search {
        @apply px-4 py-6 text-center text-[12px] text-[#a3a3a3];
    }
    .ae-group-header {
        @apply flex items-start gap-2 px-2 py-1.5 bg-[#2c2c2c] select-none transition-colors hover:bg-[#333333] items-center;
    }
    .ae-collapse-trigger {
        @apply flex items-center justify-center w-5 h-5 mt-[2px] rounded bg-[#1f1f1f] text-[#a0a0a0] text-[10px] border border-[#3f3f46] cursor-pointer;
    }
    .ae-collapse-trigger:hover {
        @apply text-[#f8fafc] border-[#4c4c4f] bg-[#353535];
    }
    .ae-collapse-icon {
        @apply w-3 h-3 flex items-center justify-center text-[10px] transition-transform;
    }
    .ae-collapse-icon.collapsed {
        @apply -rotate-90;
    }
    .ae-group-meta {
        @apply flex flex-col gap-0.5 flex-1;
    }
    .ae-group-title-row {
        @apply flex items-center gap-1;
    }
    .ae-group-label {
        @apply font-bold text-[11px] text-[#e0e0e0];
    }
    .ae-property-list {
        @apply bg-[#2c2c2c];
    }
    .ae-property-list-empty {
        @apply bg-[#2c2c2c] px-3 py-4;
    }
    .ae-property-empty {
        @apply text-[11px] text-[#9ca3af];
    }
    .ae-property-row {
        @apply flex flex-wrap items-center gap-2 px-2 py-1 border-b;
        padding-left: 26px;
        min-height: 24px;
        border-color: rgba(255, 255, 255, 0.05);
    }
    .ae-property-row:hover {
        @apply bg-white/5;
    }
    .ae-property-label {
        @apply flex items-center gap-1 shrink-0 min-w-0;
    }
    .ae-property-row-error {
        border-color: rgba(248, 113, 113, 0.45);
        background-color: rgba(127, 29, 29, 0.35);
    }
    .ae-property-name {
        @apply text-[11px] text-[#e0e0e0] select-none truncate max-w-[180px];
    }
    .ae-animation-icon {
        @apply w-[14px] h-[14px] ml-1 flex items-center justify-center text-[10px] text-[#666] cursor-pointer transition-colors;
    }
    .ae-animation-icon:hover {
        color: var(--twc-accent);
    }
    .ae-animation-icon.active {
        color: var(--twc-accent);
    }
    .ae-property-controls {
        @apply flex items-center gap-1.5 flex-1 justify-end flex-wrap min-w-0;
    }
    .ae-property-error {
        @apply text-[11px];
        color: #fecaca;
        background-color: rgba(127, 29, 29, 0.5);
        border: 1px solid rgba(248, 113, 113, 0.4);
        border-radius: 4px;
        padding: 6px 8px;
        line-height: 1.25;
        max-width: 100%;
        word-break: break-word;
    }
    .ae-property-error strong {
        @apply block;
        color: #fee2e2;
        font-weight: 600;
        margin-bottom: 2px;
    }
    .ae-macro-assignment {
        @apply relative flex-shrink-0;
    }
    .ae-macro-trigger {
        @apply h-5 px-2 text-[10px] rounded border border-transparent text-[#a0a0a0] bg-transparent flex items-center gap-1 cursor-pointer transition-colors;
    }
    .ae-macro-trigger:hover {
        @apply text-[#f1f5f9] border-[#3f3f46] bg-white/5;
    }
    .ae-macro-trigger.assigned {
        @apply bg-[#383838] border border-control2 text-[#e0e0e0];
    }
    .ae-macro-trigger.assigned:hover {
        @apply border-accent text-white;
    }
    .ae-macro-trigger.disabled {
        @apply cursor-not-allowed text-[#4b5563];
    }
    .ae-macro-label-text {
        @apply whitespace-nowrap;
    }
    .ae-macro-caret {
        @apply text-[8px] leading-none;
    }
    .ae-macro-menu {
        @apply absolute right-0 mt-1 min-w-[160px] rounded border border-[#383838] bg-[#1f1f1f] shadow-lg z-20;
    }
    .ae-macro-options {
        @apply flex flex-col py-1;
    }
    .ae-macro-option {
        @apply text-left px-3 py-1 text-[11px] text-[#e0e0e0] hover:bg-white/10 transition-colors;
    }
    .ae-macro-option.danger {
        @apply text-red-300 hover:text-red-200 hover:bg-red-500/20;
    }
    .ae-macro-divider {
        @apply h-px my-1 bg-[#2f2f2f];
    }
    .ae-macro-empty {
        @apply px-3 py-2 text-[11px] text-[#9ca3af];
    }
    .ae-property-input {
        @apply flex-[1_1_140px] min-w-[120px] max-w-[220px];
    }
    .ae-style .ae-property-input input,
    .ae-style .ae-property-input select {
        @apply w-full h-5 px-1.5 text-[11px] bg-[#383838] border border-control2 rounded text-[#e0e0e0] outline-none focus:border-accent focus:ring-1 focus:ring-accent/30;
    }
    .ae-style .ae-property-input input:disabled,
    .ae-style .ae-property-input select:disabled {
        @apply bg-[#2a2a2a] text-neutral-500 border-[#3a3a3a];
    }
    .ae-style .ae-property-input input[type='checkbox'] {
        @apply w-[14px] h-[14px] m-0;
        accent-color: #0e639c;
    }
    .ae-style .ae-property-input input[type='color'] {
        @apply w-10 h-5 p-0.5 rounded cursor-pointer;
    }
    .ae-style .ae-property-input input[type='range'] {
        @apply w-full h-1 border-0 rounded outline-none cursor-pointer;
        background-color: var(--twc-control2);
    }
    .color-input-wrapper {
        @apply relative;
    }
    .color-input-trigger {
        @apply flex items-center gap-2 w-full h-5 px-1.5 text-[11px] rounded border border-control2 bg-[#383838] text-[#e0e0e0] transition-colors;
    }
    .color-input-trigger:focus {
        @apply border-accent ring-1 ring-accent/30 outline-none;
    }
    .color-input-trigger:hover:not(:disabled) {
        @apply border-accent/60;
    }
    .color-input-trigger:disabled,
    .color-input-trigger--disabled {
        @apply bg-[#2a2a2a] text-neutral-500 border-[#3a3a3a] cursor-not-allowed;
    }
    .color-input-trigger__swatch {
        @apply w-3.5 h-3.5 rounded border border-[#1c1c1c] shadow-inner;
    }
    .color-input-trigger__label {
        @apply uppercase tracking-wide text-[10px] leading-none font-medium text-left flex-1;
    }
    .color-input-popover {
        @apply z-[80] rounded-md p-3;
        min-width: 230px;
    }
    .animation-test-page {
        @apply text-neutral-200 font-sans;
        background-color: var(--twc-background);
    }
    .animation-test-page h1,
    .animation-test-page h2 {
        @apply font-semibold tracking-wide;
    }
    .phase-card {
        @apply border border-neutral-700 p-2 mb-2 bg-black/90 rounded;
    }
    .phase-card.active {
        @apply bg-[#223a55] border-[#25608a];
    }
    .text-input,
    .number-input,
    .select-input {
        @apply text-neutral-200 border px-1.5 py-1 rounded text-xs;
        background-color: var(--twc-menubar);
        border-color: var(--twc-control2);
    }
    .text-input:focus,
    .number-input:focus,
    .select-input:focus {
        @apply outline-none ring-2 ring-accent/25 border-accent;
    }
    .color-input {
        @apply w-12 h-8 p-0.5 border rounded;
    }
    /* .btn.small and .btn:disabled removed; using inline utilities */
    .field-label {
        @apply text-[11px] flex flex-col gap-1 text-neutral-300;
    }
    .grid-inputs {
        @apply flex flex-wrap gap-3 mb-3;
    }
    .animation-test-page select option {
        @apply text-neutral-200;
        background-color: var(--twc-background);
    }
}

@layer utilities {
    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
}

/* Responsive rules ported */
@layer components {
    @media (max-width: 1200px) {
        .main-workspace {
            @apply flex-col;
        }
        .preview-panel {
            @apply flex-1 border-r-0 border-b border-border;
        }
        /* side-panels responsive rules removed (now inlined) */
        .scene-name-display,
        .scene-name-input {
            @apply max-w-[250px];
        }
        #canvas {
            @apply w-[300px] h-[300px];
        }
    }
    @media (max-width: 768px) {
        .menu-bar {
            @apply flex-wrap h-auto min-h-12 p-2;
        }
        .menu-section {
            margin-bottom: 4px;
        }
        .scene-name-section {
            order: -1;
            width: 100%;
            margin-bottom: 8px;
        }
        .scene-name-display,
        .scene-name-input {
            @apply max-w-[200px];
        }
        /* side-panels responsive rules removed (now inlined) */
        #canvas {
            @apply w-[250px] h-[250px];
        }
    }
}
